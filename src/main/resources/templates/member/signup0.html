<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SB Admin 2 - SignUp</title>

    <!-- Custom fonts for this template-->
    <link href="/css/all.css" rel="stylesheet" type="text/css">
    <link
            href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
            rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="/css/sb-admin-2.css" rel="stylesheet">

</head>

<body class="bg-gradient-primary">

<div class="container">

    <div class="card o-hidden border-0 shadow-lg my-5">
        <div class="card-body p-0">
            <!-- Nested Row within Card Body -->
            <div class="row">
                <div class="col-lg-5 d-none d-lg-block bg-register-image"
                     style="align-items:center !important; display: flex !important; justify-content:center !important;">
                    <img src="/img/register.png" alt="Ïù¥ÎØ∏ÏßÄ ÏûêÎ¶¨" width="191" height="187">
                </div>
                <div class="col-lg-7">
                    <div class="p-5">
                        <div class="text-center">
                            <h1 class="h4 text-gray-900 mb-4">Create an Account!</h1>
                        </div>

                        <!-- error Î©îÏãúÏßÄ ÌëúÏãú -->
                        <div th:if="${error}" class="text-center text-danger mb-3">
                            <span th:text="${error}"></span>
                        </div>

                        <!-- signup form -->
                        <form action="/member/signup2" method="POST" id="signUpForm" class="user">
                            <!-- ID Ï§ëÎ≥µÏ≤¥ÌÅ¨ Î∂ÄÎ∂Ñ -->
                            <div class="form-group row">
                                <!-- 6Ïπ∏: ÏûÖÎ†• ÌïÑÎìú -->
                                <div class="col-sm-6">
                                    <input type="text" class="form-control form-control-user" id="inputId"
                                           name="userId" placeholder="ID">
                                </div>
                                <!-- 4Ïπ∏: Ï§ëÎ≥µ Ï≤¥ÌÅ¨ Í≤∞Í≥º -->
                                <div class="col-sm-4">
                                    <span id="idCheckResult" style="font-size: 0.85rem; display: block;"></span>
                                </div>
                                <!-- 2Ïπ∏: Î≤ÑÌäº -->
                                <div class="col-sm-2">
                                    <button type="button" class="btn btn-primary btn-user btn-block" id="checkIdBtn">
                                        Check
                                    </button>
                                </div>
                            </div>

                            <!-- Password, repeat password -->
                            <div class="form-group row">
                                <div class="col-sm-6 mb-3 mb-sm-0">
                                    <input type="password" class="form-control form-control-user"
                                           id="inputPassword" name="userPw" placeholder="Password">
                                </div>
                                <div class="col-sm-6">
                                    <input type="password" class="form-control form-control-user"
                                           id="repeatPassword" placeholder="Repeat Password">
                                </div>
                            </div>

                            <!-- Name -->
                            <div class="form-group">
                                <input type="text" class="form-control form-control-user" id="inputName"
                                       name="userName" placeholder="Name">
                            </div>

                            <!-- Email & Ïù∏Ï¶ù Î≤ÑÌäº -->
                            <div class="form-group row">
                                <div class="col-sm-8 mb-3 mb-sm-0">
                                    <input type="email" class="form-control form-control-user" id="inputEmail"
                                           name="userEmail" placeholder="Email Address">
                                </div>
                                <div class="col-sm-4">
                                    <button type="button" class="btn btn-info btn-user btn-block" id="sendEmailBtn">
                                        Ïù∏Ï¶ù Î©îÏùº Î∞úÏÜ°
                                    </button>
                                </div>
                            </div>

                            <!-- Ïù∏Ï¶ùÏΩîÎìú ÏûÖÎ†• -->
                            <div class="form-group">
                                <input type="text" class="form-control form-control-user" id="emailAuthCodeInput"
                                       name="emailAuthCodeInput" placeholder="Ïù¥Î©îÏùºÎ°ú Ï†ÑÏÜ°Îêú Ïù∏Ï¶ùÏΩîÎìú ÏûÖÎ†•">
                            </div>

                            <!-- Register Account Î≤ÑÌäº -->
                            <button type="button" id="submitBtn" class="btn btn-primary btn-user btn-block">
                                Register Account
                            </button>
                        </form>
                        <hr>
                        <div class="text-center">
                            <a class="small" href="/">Already have an account? Login!</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- JS -->

<!-- Bootstrap core JavaScript-->
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>
<!-- Core plugin JavaScript-->
<script src="/js/jquery.easing.min.js"></script>
<!-- Custom scripts for all pages-->
<script src="/js/sb-admin-2.min.js"></script>
<!-- axios ÎπÑÎèôÍ∏∞ ÌÜµÏã†Ïö© -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<th:block layout:fragment="script">
    <!--  ÏûêÎ∞î Ïä§ÌÅ¨Î¶ΩÌä∏ Ï∂îÍ∞Ä ÏΩîÎìú  -->
    <script>
        // Ï†ÑÏó≠Î≥ÄÏàò ÏÑ§Ï†ï
        let idCheckPass = false; // ÏïÑÏù¥Îîî Ï§ëÎ≥µ Ï≤¥ÌÅ¨ ÏïàÌï®.

        // ID Ï§ëÎ≥µ Ï≤¥ÌÅ¨ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        document.getElementById("checkIdBtn").addEventListener("click", function () {
            const id = document.getElementById("inputId").value.trim();
            if (!id) {
                alert("ÏïÑÏù¥ÎîîÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
                return;  // Ìï®Ïàò Ìò∏Ï∂úÏãú ÎçîÏù¥ÏÉÅ ÏßÑÌñâÌïòÍ≥† Ïã∂ÏßÄ ÏïäÏùÑ Îïå: returnÌïòÎ©¥ Ï¢ÖÎ£å
            }
            if (id.length < 4) {
                alert("ÏïÑÏù¥ÎîîÎäî ÏµúÏÜå 4Í∏ÄÏûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§. Îã§Ïãú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
                return;
            }

            // ÏÑúÎ≤ÑÎ°ú Ï§ëÎ≥µ Ï≤¥ÌÅ¨ ÏöîÏ≤≠
            axios
                .get("/member/checkId?userId=" + id)
                .then(function (response) {
                    const result = response.data; // http body Ï∂îÏ∂ú
                    const idCheckResult = document.getElementById("idCheckResult");
                    if (result) {
                        // span ÌÉúÍ∑∏ ÏÇ¨Ïù¥Ïóê ÎÑ£Ïñ¥ÏïºÌï®.
                        idCheckPass = true; // ÏïÑÏù¥Îîî Ï§ëÎ≥µ Ï≤¥ÌÅ¨ ÏôÑÎ£å
                        idCheckResult.style.color = "green";
                        idCheckResult.textContent = "üéâ ÏÇ¨Ïö© Í∞ÄÎä•Ìïú ÏïÑÏù¥Îîî.";
                    } else {
                        idCheckResult.style.color = "red";
                        idCheckResult.textContent = "‚ö†Ô∏è Ïù¥ÎØ∏ ÏÇ¨Ïö© Ï§ëÏù∏ ÏïÑÏù¥Îîî.";
                    }
                })
                .catch(function (error) {
                    alert("ÏïÑÏù¥Îîî Ï§ëÎ≥µ Ï≤¥ÌÅ¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.");
                    console.log(error);
                });

            // ÏÑúÎ≤ÑÎ°úÎ∂ÄÌÑ∞ Ï§ëÎ≥µÏ≤¥ÌÅ¨ Í≤∞Í≥ºÎ•º Î∞õÏùÄ Ïù¥ÌõÑÏóê Ï∂úÎ†•
            // (ÏÇ¨Ïö© Í∞ÄÎä•Ìïú ÏïÑÏù¥Îîî, Î∂àÍ∞ÄÎä•Ìïú ÏïÑÏù¥ÎîîÏù∏ÏßÄ Ï∂úÎ†•)
        });

        // ID ÏûÖÎ†• ÌïÑÎìú Î≥ÄÍ≤Ω Ïãú Ï§ëÎ≥µÏ≤¥ÌÅ¨ ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
        document.getElementById("inputId").addEventListener("input", function () {
            idCheckPass = false; // IDÍ∞Ä Î≥ÄÍ≤ΩÎêòÎ©¥ Ï§ëÎ≥µ Ï≤¥ÌÅ¨ ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            const idCheckResult = document.getElementById("idCheckResult");
            idCheckResult.textContent = ""; // Í≤∞Í≥º Î©îÏãúÏßÄÎèÑ Ï¥àÍ∏∞Ìôî
        });

        // [Ïù¥Î©îÏùº Ïù∏Ï¶ùÏΩîÎìú Î∞úÏÜ°] --------------------
        document.getElementById("sendEmailBtn").addEventListener("click", function () {
            const email = document.getElementById("inputEmail").value.trim();
            if (!email) {
                alert("Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
                return;
            }
            // Ïù¥Î©îÏùº ÌòïÏãù ÌôïÏù∏
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailPattern.test(email)) {
                alert("Ïò¨Î∞îÎ•∏ Ïù¥Î©îÏùº ÌòïÏãùÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!");
                return;
            }

            // ÏÑúÎ≤ÑÏóê Ïù¥Î©îÏùº Ïù∏Ï¶ùÏΩîÎìú Î∞úÏÜ° ÏöîÏ≤≠
            axios.post("/member/sendCode", null, {
                params: { userEmail: email }
            })
                .then(function (response) {
                    if (response.data === "success") {
                        alert("Ïù∏Ï¶ùÏΩîÎìúÍ∞Ä Ïù¥Î©îÏùºÎ°ú Î∞úÏÜ°ÎêòÏóàÏäµÎãàÎã§. Î©îÏùºÌï®ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.");
                    } else {
                        alert("Ïù¥Î©îÏùº Î∞úÏÜ° Ïã§Ìå®. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.");
                    }
                })
                .catch(function (error) {
                    alert("Ïù¥Î©îÏùº Î∞úÏÜ° Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.");
                    console.log(error);
                });
        });

        // Ìèº Ï†úÏ∂ú Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        document.getElementById("submitBtn").addEventListener("click", function () {
            const inputId = document.getElementById("inputId").value.trim();
            const inputPassword = document.getElementById("inputPassword").value.trim();
            const repeatPassword = document.getElementById("repeatPassword").value.trim();
            const inputName = document.getElementById("inputName").value.trim();
            const inputEmail = document.getElementById("inputEmail").value.trim();
            const emailAuthCodeInput = document.getElementById("emailAuthCodeInput").value.trim();
            console.log(inputId + " " + inputPassword + " " + inputName + " " + inputEmail);

            // Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
            // Ïù¥Î©îÏùº Ï†ïÍ∑úÏãù
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            // Ïù¥Î©îÏùº ÌòïÏãù Í≤ÄÏ¶ù
            if (!emailPattern.test(inputEmail)) {
                alert("Ïò¨Î∞îÎ•∏ Ïù¥Î©îÏùº ÌòïÏãùÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!");
                return;
            }
            // 1) ID Ï§ëÎ≥µÏ≤¥ÌÅ¨ Ïó¨Î∂Ä
            if (!idCheckPass) {
                alert("ÏïÑÏù¥Îîî Ï§ëÎ≥µ Ï≤¥ÌÅ¨Î•º ÏôÑÎ£åÌï¥Ï£ºÏÑ∏Ïöî.");
                return;
            }
            // 2) ÌïÑÏàòÍ∞í Í≤ÄÏÇ¨
            if (!inputId || !inputPassword || !inputName || !inputEmail || !emailAuthCodeInput) {
                alert("Î™®Îì† ÏûÖÎ†•Í∞íÏùÑ Ï†ïÌôïÌûà Ï±ÑÏõåÏ£ºÏÑ∏Ïöî.");
                return;
            }
            // 3) ÎπÑÎ∞ÄÎ≤àÌò∏ ÎèôÏùºÏÑ± Í≤ÄÏÇ¨
            if (inputPassword !== repeatPassword) {
                alert("ÏûÖÎ†•Ìïú ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§. Îã§Ïãú ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.");
                return;
            }
            // ÎπÑÎ∞ÄÎ≤àÌò∏ ÏµúÏÜå Í∏∏Ïù¥ ÏòàÏãú
            if (inputPassword.length < 4) {
                alert("ÎπÑÎ∞ÄÎ≤àÌò∏Îäî ÏµúÏÜå 4Í∏ÄÏûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§. Îã§Ïãú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
                return;
            }

            // Ïù¥ Ìï®ÏàòÍ∞Ä returnÏúºÎ°ú Ï§ëÎã®ÎêòÏßÄ ÏïäÏïòÏúºÎ©¥ Ìèº Ï†ÑÏÜ°Ìï¥Ï£ºÏÑ∏Ïöî
            // ÏûêÎ∞îÏä§ÌÅ¨Î¶ΩÌä∏Î°ú Ïú†Ìö®ÏÑ± Í≤ÄÏ¶ù ÌõÑ submit ÌïòÎ†§Î©¥
            // formÎÇ¥Ïùò buttonÏùò typeÏùÑ type="button"ÏúºÎ°ú Î∞îÍøîÏ§å.
            // 4) Ìèº Ï†úÏ∂ú
            document.getElementById("signUpForm").submit();
            alert("ÌöåÏõêÍ∞ÄÏûÖÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§. ÌôòÏòÅÌï©ÎãàÎã§!")
        });

    </script>
</th:block>
</body>

</html>